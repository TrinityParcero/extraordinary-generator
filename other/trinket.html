<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../styles/trinkets.css">
    <link href="https://fonts.googleapis.com/css?family=Catamaran:300,500,900" rel="stylesheet">
    <title>Random Trinkets</title>
    <link rel="icon" type="image/png" href="../images/trinket.jpg">
</head>
<body>
    <script src="trinket.js"></script>
    <div id="header">
        <h1>The Extraordinary</h1>
        <h1>Generator of Trinkets</h1>
    <p id="name">For all your trinket needs!</p>
        <a href="../index.html"><img src="../images/home.png" alt="home icon" height="50px" width="50px" id="homeIcon"></a>
    </div>
    <div id="content">
        <fieldset id="sources">
        <legend>Source Material</legend>
        <button id="sourceAll" class="allButton">select all</button>
        <input type="checkbox" id="phb" name="source" value="phb">
        <label for="phb">Player's Handbook</label>
        
        <input type="checkbox" id="ee" name="source" value="ee">
        <label for="ee">Elemental Evil</label>
        
        <input type="checkbox" id="cos" name="source" value="cos">
        <label for="cos">Curse of Strahd</label>
        
        <input type="checkbox" id="llok" name="source" value="llok">
        <label for="llok">Lost Laboratory of Kwalish</label>
        </fieldset>
        
    <div id="gen">
    <!--number choice-->
    <p id="howMany">how many trinkets?</p>
    <fieldset>
       <input type="radio" id="num1" name="num" value="1">
        <label for="num1">1</label>
        
        <input type="radio" id="num2" name="num" value="5">
        <label for="num2">5</label>
        
        <input type="radio" id="num3" name="num" value="10">
        <label for="num3">10</label>
    </fieldset>
        
        <div id="generator">
        <p id="generated"></p>
        <button id="genButton">generate</button>
        </div>
        </div>
        
    </div>
    
    <div id="footerbar">
        <p>Illustrations by Larry Elmore</p>
    <p>Trinity Parcero                  2018</p>
    </div>
    
    <!-- JAVASCRIPT -->
    <script>
    "use strict";

        //generator button
        let genButton = document.getElementById("genButton");
        //generator box
        let genBox = document.getElementById("generator");
    
        //p tag where generated trinkets go
        let p = document.querySelector("#generated");
        
        //possible trinkets
        let posTrinkets = [];
    
        //selected sources
        let sourceSelected = [];
        

        //num radios
        let nums = document.querySelectorAll("input[name=num]")
        let numSelected; 
        
        //get all checkboxes
        let phb = document.querySelector("#phb");
        let ee = document.querySelector("#ee");
        let cos = document.querySelector("#cos");
        let llok = document.querySelector("#llok");
        
        //get all source button
        let sourceAll = document.querySelector("#sourceAll");
        
        //sourceall button function
        sourceAll.addEventListener("click", function(){
            phb.checked = !phb.checked;
            ee.checked = !ee.checked;
            cos.checked = !cos.checked;
            llok.checked = !llok.checked;
        });
        
        let setUpSearch = function(){
            
            //put checked sources in selected
            if(phb.checked){
                sourceSelected[sourceSelected.length] = (phb.value);
            }
            if(ee.checked){
                sourceSelected[sourceSelected.length] =  (ee.value);
            }
            if(cos.checked){
                sourceSelected[sourceSelected.length] = (cos.value);
            }
            if(llok.checked){
                sourceSelected[sourceSelected.length] = (llok.value);
            }
            
            for(let i=0; i < sourceSelected.length; i++){
                let propName;
                if(sourceSelected[i] != undefined){
                    propName = sourceSelected[i];
                    if(trinkets[propName] != undefined){
                        posTrinkets += (trinkets[propName]);
                    }
                    
                }
            }
            
            
            //go thru nums radio, set checked one as numSelected
            for(let i = 0; i < nums.length; i++){
                if(nums[i].checked){
                    numSelected = nums[i].value;
                    //futz with size of genBox
                    if(numSelected == 1){
                        genBox.style.height = "100px";
                    }
                    if(numSelected == 5){
                        genBox.style.height = "400px";
                    }
                    if(numSelected == 10){
                        genBox.style.minHeight = "600px";
                    }
                }
            }
        }
        
        //split up the trinkets list
        let loadTrinkets = function(){
            //split trinkets by periods
            posTrinkets = posTrinkets.split(".");
            
        }
        
        //show the random trinket(s)
        let showTrinkets = function(){
            let genTrinkets = [];
            //for numselected, generate trinkets
            for(let i = 0; i < numSelected; i++){
                let rando = Math.floor(Math.random() * Math.floor(posTrinkets.length));
                while(rando == 0){
                    rando = Math.floor(Math.random() * Math.floor(posTrinkets.length));
                }
                if(posTrinkets[rando] != undefined){
                    console.log(rando);
                    console.log(posTrinkets[rando]);
                    genTrinkets[i] = posTrinkets[rando];
                    p.innerHTML += (genTrinkets[i] + "<br>" + "<br>");
                }
                
            }
        }
        
         //onclick of generator button
        genButton.addEventListener('click', function(){
        
            //clear old values
            p.innerHTML = "";
            sourceSelected = [];
            numSelected = 0;
        
            setUpSearch();
            loadTrinkets();
            showTrinkets();
        });
        
    </script>
</body>
</html>